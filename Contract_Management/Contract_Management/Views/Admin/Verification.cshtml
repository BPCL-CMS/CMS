
@{
    ViewBag.Title = "Verification";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<link href="~/Resources/JqueryTab/tab_style.css" rel="stylesheet" />
<link href="~/Resources/ImageSlider/css/wipeSlider.css" rel="stylesheet" />

<ul class="breadcrumb">
    <li><a href="@Url.Action("../Home/Index")">Home</a></li>
    <li class="active">Verification</li>
</ul>
<input type="hidden" id="VENDOR_CODE" name="VENDOR_CODE" value="1501" />





    <h2>Verification</h2>
<div class="tabDiv">
    <ul class="tabs">
        <li class="tab-link current" data-tab="tab-1">Contractor</li>
        <li class="tab-link" data-tab="tab-2">Job</li>
        <li class="tab-link" data-tab="tab-3">Employee</li>
    </ul>

    <div id="tab-1" class="tab-content current">
        <fieldset id="VendorField">
            <div class="panel panel-primary">
                <div class="panel-heading clearfix">
                    <div class="col-lg-10">
                        <h3 class="panel-title"><i class="fa fa-users"></i> Vendor Details</h3>
                    </div>

                </div>
                <fieldset class="panel-body">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group row">
                                <label for="label-name" class="col-sm-4 col-form-label">PO Number</label>
                                <div class="col-sm-8">
                                    <input type="text" id="VendorNo" name="VendorNo" class="select2 " style="width:100%" />
                                </div>
                            </div>
                        </div>

                    </div>
                    <fieldset disabled id="vendorDiv"></fieldset>
                    <br /><br />
                    <div class="col-lg-4"></div>
                    <div class="col-lg-8">
                        <fieldset id="buttonDiv" style="display:none;">
                            <button type="button" id="btnApprove" class="btn btn-primary" onclick="ChangeVendorStatus('Approve')">Approve</button>
                            <button type="button" id="btnSendback" class="btn btn-primary" onclick="ChangeVendorStatus('Sendback')">Send Back</button>
                            <button type="button" id="btnReject" class="btn btn-primary" onclick="ChangeVendorStatus('Reject')">Reject</button>
                        </fieldset>
                    </div>
                </fieldset>
            </div>
        </fieldset>
    </div>
    <div id="tab-2" class="tab-content">
        <fieldset id="JobField">
            <div class="panel panel-primary">
                <div class="panel-heading clearfix">
                    <div class="col-lg-10">
                        <h3 class="panel-title"><i class="fa fa-users"></i> Job Details</h3>
                    </div>

                </div>
                <fieldset class="panel-body">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="form-group row">
                                <label for="label-name" class="col-sm-4 col-form-label">PO Number</label>
                                <div class="col-sm-8">
                                    <input type="text" id="PO_NUM" name="PO_NUM" class="select2 " style="width:100%" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <fieldset id="JobPartial" disabled style="display:none;">
                            @{ Html.RenderPartial("../Contractor/JobsPartial");}
                        </fieldset>
                    </div>
                    <div class="col-lg-6">
                        <div class="slidesWrap js_wiper">
                            <ul class="slides" id="JobSlider"></ul><!-- / .slides -->
                        </div>
                    </div>

                    <br /><br />
                    <div class="col-lg-8">
                        <div class="col-lg-4"></div>
                        <div class="col-lg-8">
                            <fieldset id="JobbuttonDiv" style="display:none;">
                                <button type="button" id="btnApprove" class="btn btn-primary" onclick="ChangeJobStatus('Approve')">Approve</button>
                                <button type="button" id="btnSendback" class="btn btn-primary" onclick="ChangeJobStatus('Sendback')">Send Back</button>
                                <button type="button" id="btnReject" class="btn btn-primary" onclick="ChangeJobStatus('Reject')">Reject</button>
                            </fieldset>
                        </div>
                    </div>


                </fieldset>
            </div>



        </fieldset>
    </div>
    <div id="tab-3" class="tab-content">
        <fieldset id="EmpField">
            <div class="panel panel-primary">
                <div class="panel-heading clearfix">
                    <div class="col-lg-10">
                        <h3 class="panel-title"><i class="fa fa-users"></i> Employee Details</h3>
                    </div>

                </div>
                <fieldset class="panel-body">
                    <div class="row">
                        @*<div class="col-lg-6">
                            <div class="form-group row">
                                <label for="label-name" class="col-sm-4 col-form-label">PO Number</label>
                                <div class="col-sm-8">
                                    <input type="text" id="EMPVendorNo" name="EMPVendorNo" class="select2 " style="width:100%" />
                                </div>
                            </div>
                        </div>*@
                        <div class="col-lg-6">
                            <div class="form-group row">
                                <label for="label-name" class="col-sm-4 col-form-label">PO Number</label>
                                <div class="col-sm-8">
                                    <input type="text" id="EMP_PO_NUM" name="EMP_PO_NUM" class="select2 " style="width:100%" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="form-group row">
                                <label for="label-name" class="col-sm-4 col-form-label">Employee AADHAR No</label>
                                <div class="col-sm-8">
                                    <input type="text" id="EMP_AADHAR" name="EMP_AADHAR" class="select2 " style="width:100%" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div id="EMPPartial" disabled>
                            @*@{ Html.RenderPartial("../Contractor/EmployeePartial");}*@
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="slidesWrap js_wiper">
                            <ul class="slides" id="EmpSlider"></ul><!-- / .slides -->
                        </div>
                    </div>

                    <br /><br />
                    <div class="col-lg-12">
                        <div class="col-lg-4"></div>
                        <div class="col-lg-8">
                            <fieldset id="EmpbuttonDiv" style="display:none;">
                                <button type="button" id="btnApprove" class="btn btn-primary" onclick="ChangeEMPStatus('Approve')">Approve</button>
                                <button type="button" id="btnSendback" class="btn btn-primary" onclick="ChangeEMPStatus('Sendback')">Send Back</button>
                                <button type="button" id="btnReject" class="btn btn-primary" onclick="ChangeEMPStatus('Reject')">Reject</button>
                            </fieldset>
                        </div>
                    </div>


                </fieldset>
            </div>



        </fieldset>
    </div>

</div>


<script src="~/Resources/JqueryTab/jpix.js"></script>
<script src="~/Resources/ImageSlider/script/jquery.wipeSlider.js"></script>
<script>
    $(document).ready(function () {
        $(".nav,li").removeClass('active');
        $("#Verification").addClass('active');
        BindVendorSelect2();
        BindPO_NUMSelect2();
        //$('.js_wiper').wipeSlider();
        BindEMP_PO_NUMSelect2()

    });

    $(function () {
        $('ul.tabs').pixiefyTabs();
        $('ul.accordion').pixiefyAccordion();
    })


    function BindVendorSelect2() {
        $("#VendorNo").select2({
            placeholder: 'Select Vendor',
            allowClear: true,
            minimumInputLength: 0,
            ajax: {

                url: "../Contractor/GetAllVendorCodes/",
                dataType: 'json',
                quietMillis: 250,
                type: "POST",
                data: function (term, page, type) {
                    return {
                        q: term, //search term
                        page: page, // page number
                        type: type,

                    };
                },

                results: function (data, page) {
                    debugger
                    data = JSON.parse(data);
                    var more = (page * 30) < data.total_count;
                    return { results: data.items, more: more };
                }
            }
        });

        
        $("#EMPVendorNo").select2({
            placeholder: 'Select Vendor',
            allowClear: true,
            minimumInputLength: 0,
            ajax: {

                url: "../Contractor/GetAllVendorCodes/",
                dataType: 'json',
                quietMillis: 250,
                type: "POST",
                data: function (term, page, type) {
                    return {
                        q: term, //search term
                        page: page, // page number
                        type: type,

                    };
                },

                results: function (data, page) {
                    debugger
                    data = JSON.parse(data);
                    var more = (page * 30) < data.total_count;
                    return { results: data.items, more: more };
                }
            }
        });
    }

    $('#VendorNo').on("change", function (e) {
        //var data = $('#VendorNo').select2('data');
        //var VENDOR_CODE = data.text;
        var VENDOR_CODE = $('#VendorNo').val();
        var url = "../Contractor/VendorDetailsPartial";
        var data = { VENDOR_CODE: VENDOR_CODE }
        $.post(url, data, function (result) {
            debugger
            if (result != null && VENDOR_CODE != 0) {
                $('#vendorDiv').html(result);
                $("#buttonDiv").show();

            }

        });



        // $("#vendorDiv").load("../Contractor/VendorDetailsPartial",
        //{ VENDOR_CODE: VENDOR_CODE, viewName: "VendorPartial.cshtml" });


    });

    $('#VendorNo').on("change", function (e) {
        var VENDOR_CODE = $('#VendorNo').val();
        $("#VENDOR_CODE").val(VENDOR_CODE);

    });

    function ChangeVendorStatus(status) {
        var VENDOR_CODE = $('#VendorNo').val();
        var url = "../Contractor/StatusChange";
        var data = { STATUS: status, VENDOR_CODE: VENDOR_CODE }
        $.post(url, data, function (result) {
            if (result == "Approved") {
                $.notify("Vendor Approved Successfully!!", "success");
                $('#vendorDiv').html("");
                $("#buttonDiv").hide();
                $("#VendorNo").select2('destroy');
                BindVendorSelect2();
                $("#VendorNo").select2('data', { id: 0, text: "Select Vendor" }).trigger('change');
                $("#VendorField").hide();
                $("#JobField").show();
                $("#VENDOR_CODE").val(VENDOR_CODE);

            }
        })
    }
    function ChangeJobStatus(status) {
        var PO_NUM = $("#PO_NUM").val();
        var url = "../Contractor/JobStatusChange";
        var data = { STATUS: status, PO_NUM: PO_NUM }
        $.post(url, data, function (result) {
            if (result == "Approved") {
                $.notify("Job Approved Successfully!!", "success");
                $('#vendorDiv').html("");
                $("#buttonDiv").hide();
                $("#VendorNo").select2('destroy');
                BindVendorSelect2();
                $("#VendorNo").select2('data', { id: 0, text: "Select Vendor" }).trigger('change');
                $("#VendorField").hide();
                $("#JobField").show();
                $("#VENDOR_CODE").val(VENDOR_CODE);

            }
        })
    }


    function BindPO_NUMSelect2() {
        var VENDOR_CODE = $("#VENDOR_CODE").val();
        $("#PO_NUM").select2({
            placeholder: 'Select PO Number',
            allowClear: true,
            minimumInputLength: 0,
            ajax: {

                url: "../Contractor/GetAllPONumByVendorCodeSelect2/",
                dataType: 'json',
                quietMillis: 250,
                type: "POST",
                data: function (term, page, type) {
                    return {
                        q: term, //search term
                        page: page, // page number
                        type: type,
                        VENDOR_CODE: VENDOR_CODE,
                    };
                },

                results: function (data, page) {
                    debugger
                    data = JSON.parse(data);
                    var more = (page * 30) < data.total_count;
                    return { results: data.items, more: more };
                }
            }
        });
    }


    function BindJobData() {
        debugger
        var PO_NUM = $("#PO_NUM").val();
        var url = "../Contractor/GetAllJobsByPO_NUM";
        var data = { PO_NUM: PO_NUM }
        $.post(url, data, function (result) {
            debugger
            if ((JSON.parse(result).success) == true) {
                result = JSON.parse(result).results;
                $("#JOB_ID").val(result["JOB_ID"]);
                $("#PO_NUM").val(result["PO_NUM"]);
                $("#JOB_NAME").val(result["JOB_NAME"]);
                if (result["ARC"] == true) {
                    $('input[name="ARC"]').attr('checked', false);
                    $("#IsARC1").prop("checked", true);
                    $("#div_ARC").prop('disabled', false);
                }
                else {
                    $('input[name="ARC"]').attr('checked', false);
                    $("#IsARC2").prop("checked", true);
                    $("#div_ARC").prop('disabled', true);
                }
                $("#ARC_ID").val(result["ARC_ID"]);
                $("#ARC").val(result["ARC"]);
                $("#ARC_NO").val(result["ARC_NO"]);
                $("#DESCRIPTION").val(result["DESCRIPTION"]);
                $("#ARC_DATE").val(ConvertJsonDateString(result["ARC_DATE"]));
                $("#SCHEDULE_FROM").val(ConvertJsonDateString(result["SCHEDULE_FROM"]));
                $("#SCHEDULE_TO").val(ConvertJsonDateString(result["SCHEDULE_TO"]));
                $("#DEACTIVATED_ON").val(ConvertJsonDateString(result["DEACTIVATED_ON"]));
                $("#DESCRIPTION").val(result["DESCRIPTION"]);
                $("#DEPT_ID").select2('data', { id: result["DEPT_ID"], text: result["DEPT_NAME"] }).trigger('change');

                //$("#DEPT_ID").val(result["DEPT_ID"]).trigger('change');
                $("#AREA").val(result["AREA"]);
                $("#CONT_ID").val(result["CONT_ID"]);
                $("#CONT_NAME").val(result["VENDOR"]);
                $("#ADDRESS").val(result["ADDRESS"]);
                if (result["HOUSE_KEEPING"] == true) {
                    $('.HOUSE_KEEPING').removeAttr('checked')
                    $("#rd_housekeeping1").prop("checked", true);
                }
                else {
                    $('.HOUSE_KEEPING').removeAttr('checked')
                    $("#rd_housekeeping2").prop("checked", true);
                }
                if (result["ONLY_EXCEMPTION"] == true) {
                    $('.ONLY_EXCEMPTION').removeAttr('checked')
                    $("#rd_excemption1").prop("checked", true);
                }
                else {
                    $('.ONLY_EXCEMPTION').removeAttr('checked')
                    $("#rd_excemption2").prop("checked", true);
                }
                $("#NO_WORKERS").val(result["NO_WORKERS"]);
                if (result["NO_WORKERS"] > 20) {
                    // EnableLisence();
                }
                $("#WORKERS_LICENSE_PASS").val(result["WORKERS_LICENSE_PASS"]);
                $("#WL_PASS_FROM").val(ConvertJsonDateString(result["WL_PASS_FROM"]));
                $("#WL_PASS_TO").val(ConvertJsonDateString(result["WL_PASS_TO"]));
                $("#STAFF_PASS").val(result["STAFF_PASS"]);
                if (result["ISWL_LICENSE_CLOSED"] == true) {
                    $('.ISWL_LICENSE_CLOSED').removeAttr('checked')
                    $("#rd_licenceClosed1").prop("checked", true);
                }
                else {
                    $('.ISWL_LICENSE_CLOSED').removeAttr('checked')
                    $("#rd_licenceClosed2").prop("checked", true);
                }
                if (result["ISMW"] == true) {
                    $('input[name="ISMW"]').attr('checked', false);
                    $("#rd_ISMW1").prop("checked", true);
                    $("#div_ISMW").prop('disabled', false);
                }
                else {
                    $('input[name="ISMW"]').attr('checked', false);
                    $("#rd_ISMW2").prop("checked", true);
                    $("#div_ISMW").prop('disabled', true);
                }
                $("#ISMW_LICENSE_PASS").val(result["ISMW_LICENSE_PASS"]);
                $("#ISMW_FROM").val(ConvertJsonDateString(result["ISMW_FROM"]));
                $("#ISMW_TO").val(ConvertJsonDateString(result["ISMW_TO"]));
                if (result["BLOCK"] == true) {
                    $('.BLOCK').removeAttr('checked')
                    $("#rd_ClearanceBlock1").prop("checked", true);
                    $("#BLOCK_REMARKS").prop('disabled', false);
                }
                else {
                    $('.BLOCK').removeAttr('checked')
                    $("#rd_ClearanceBlock2").prop("checked", true);
                    $("#BLOCK_REMARKS").prop('disabled', true);
                }
                $("#BLOCK_REMARKS").val(result["BLOCK_REMARKS"]);
                $("#SEC_REMARKS").val(result["SEC_REMARKS"]);
                $("#JobPartial").show();
                $("#JobbuttonDiv").show();
              //  $(".slidesWrap ").html("");
            }
            else {

                $("#JobPartial").hide();
                $("#JobbuttonDiv").show();
             //   $(".slidesWrap ").html("");
            }
        });
    }

    function BindJobDocs() {
        var PO_NUM = $("#PO_NUM").val();
        $("#JobSlider").empty();
        var url = "../Contractor/GetAllJobDOCSByPO_NUM";
        var data = { PO_NUM: PO_NUM }
        $.post(url, data, function (result) {
            debugger
            var data = JSON.parse(result);
            if (data.success == true) {
                for (var i = 0; i < JSON.parse(result).results.length; i++) {

                    $("#JobSlider").append('<li class="slide">' +
                                '<img src="data:image/png;base64,' + data.results[i]["DOCUMENT"] + '">' +
                                '<div class="m_innerBox">' +
                                    '<p>' + data.results[i]["PO_NUMBER"] + '</p>' +
                                '</div></li>');

                    //  $("#SliderDiv").append("<div class='slide'><img src='data:image/jpg;base64,'" + data.results[i]["DOCUMENT"] + "'></div>");

                }
                BindImages();
            }
        });
    }

    function BindImages() {

        $('.js_wiper').wipeSlider({

            auto: false,
            pager: false,
            controls: true,
            variable: true,
        });

    }

    $('#PO_NUM').on("change", function (e) {
        var PO_NUM = $("#PO_NUM").val();
        //var url = "../Contractor/JobDetailsPartial";
        //var data = { PO_NUM: PO_NUM }
        //$.post(url, data, function (result) {
        //    debugger
        //    if (result != null && VENDOR_CODE != 0) {
        //        $('#vendorDiv').html(result);
        //        $("#buttonDiv").show();

        //    }

        //});
        // $("#JobField").load("../Contractor/JobDetailsPartial", { PO_NUM: PO_NUM, viewName: "JobsPartial.cshtml" });
        BindJobData();
        BindJobDocs();
    });


    function ConvertJsonDateString(jsonDate) {
        var shortDate = null;
        if (jsonDate) {
            var regex = /-?\d+/;
            var matches = regex.exec(jsonDate);
            var dt = new Date(parseInt(matches[0]));
            var month = dt.getMonth() + 1;
            var monthString = month > 9 ? month : '0' + month;
            var day = dt.getDate();
            var dayString = day > 9 ? day : '0' + day;
            var year = dt.getFullYear();
            shortDate = dayString + '-' + monthString + '-' + year;
        }
        return shortDate;
    };



    //................................EMPLOYEE...................................


    function BindEMP_PO_NUMSelect2() {
        var VENDOR_CODE = $("#VENDOR_CODE").val();
        $("#EMP_PO_NUM").select2({
            placeholder: 'Select PO Number',
            allowClear: true,
            minimumInputLength: 0,
            ajax: {

                url: "../Contractor/GetAllEMP_PONumSelect2/",
                dataType: 'json',
                quietMillis: 250,
                type: "POST",
                data: function (term, page, type) {
                    return {
                        q: term, //search term
                        page: page, // page number
                        type: type,
                        VENDOR_CODE: VENDOR_CODE,
                    };
                },

                results: function (data, page) {
                    debugger
                    data = JSON.parse(data);
                    var more = (page * 30) < data.total_count;
                    return { results: data.items, more: more };
                }
            }
        });
    }

    $('#EMP_PO_NUM').on("change", function (e) {
        BindEMP_AADHAR_NUMSelect2();
    });

    function BindEMP_AADHAR_NUMSelect2() {
        var PO_NUM = $("#EMP_PO_NUM").val();
        $("#EMP_AADHAR").select2({
            placeholder: 'Select AAHHAR Number',
            allowClear: true,
            minimumInputLength: 0,
            ajax: {

                url: "../Contractor/GetAllEMP_AADHAR_NO_Select2/",
                dataType: 'json',
                quietMillis: 250,
                type: "POST",
                data: function (term, page, type) {
                    return {
                        q: term, //search term
                        page: page, // page number
                        type: type,
                        PO_NUM: PO_NUM,
                    };
                },

                results: function (data, page) {
                    debugger
                    data = JSON.parse(data);
                    var more = (page * 30) < data.total_count;
                    return { results: data.items, more: more };
                }
            }
        });
    }



    $('#EMP_AADHAR').on("change", function (e) {
        //var data = $('#VendorNo').select2('data');
        //var VENDOR_CODE = data.text;
        var EMP_ID = $('#EMP_AADHAR').val();
        var url = "../Contractor/GetEmployeeDetailsByIdPartial";
        var data = { EMP_ID: EMP_ID }
        $.post(url, data, function (result) {
            debugger
            if (result != null) {
                $('#EMPPartial').html("");
             //   $(".slidesWrap ").html("");
                BindEMPDocs();
                $('#EMPPartial').html(result);
                $("#EmpbuttonDiv").show();

            }

        });

        //$("#EMPPartial").load("../Contractor/GetEmployeeDetailsByIdPartial",
        //     { EMP_ID: EMP_ID, viewName: "EmployeePartial.cshtml" });


    });

    function BindEMPDocs() {
        var EMP_ID = $('#EMP_AADHAR').val();
        var url = "../Contractor/GetAllEMPDOCSByEMPID";
        var data = { EMP_ID: EMP_ID }
        $.post(url, data, function (result) {
            debugger
            var data = JSON.parse(result);
            if (data.success == true) {
                for (var i = 0; i < JSON.parse(result).results.length; i++) {

                    $("#EmpSlider").append('<li class="slide">' +
                        '<img src="data:image/png;base64,' + data.results[i]["DOCUMENT"] + '">' +
                        '<div class="m_innerBox">' +
                        '<p>' + data.results[i]["PO_NUMBER"] + '</p>' +
                        '</div></li>');

                    //  $("#SliderDiv").append("<div class='slide'><img src='data:image/jpg;base64,'" + data.results[i]["DOCUMENT"] + "'></div>");

                }
                BindImages();
            }
        });
    }

    function ChangeEMPStatus(status) {
        var EMP_ID = $('#EMP_AADHAR').val();
        var url = "../Admin/EMPStatusChange";
        var data = { STATUS: status, EMP_ID: EMP_ID }
        $.post(url, data, function (result) {
            if (result == "Approved") {
                $.notify("Employee Approved Successfully!!", "success");
                $('#EMPPartial').html("");
                $("#EmpbuttonDiv").hide();
                //$("#VendorNo").select2('destroy');
                //$("#VendorNo").select2('data', { id: 0, text: "Select Vendor" }).trigger('change');
                //$("#VendorField").hide();
                //$("#JobField").show();
                //$("#VENDOR_CODE").val(VENDOR_CODE);

            }
        })
    }


</script>
